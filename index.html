<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RIDDIM ‚Äî Members Club</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="dev-2fa-banner" style="display:none;position:fixed;top:0;left:0;right:0;background:#F5C842;color:#000;font-family:'Space Mono',monospace;font-size:18px;font-weight:bold;padding:14px;text-align:center;z-index:99999;letter-spacing:0.05em"></div>

<div class="glow-top"></div>
<div class="glow-bot"></div>
<div class="toast" id="toast"></div>

<!-- Theme Toggle -->
<button class="theme-toggle" onclick="toggleTheme()">
  <div class="theme-toggle-dot"></div>
  <span id="theme-label">DARK</span>
</button>

<div class="app">

  <!-- ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen active" id="landing">
    <div>
      <div class="logo-eyebrow">Welcome to</div>
      <div class="logo-main">RIDDIM</div>
      <div class="logo-divider"></div>
      <div class="logo-sub">CONNECT ¬∑ UNLOCK ¬∑ CELEBRATE</div>
    </div>
    <div class="btn-row">
      <button class="btn-gold" onclick="go('register')">Connect to WiFi &amp; Join</button>
      <button class="btn-ghost" onclick="go('returningAuth')">Returning Member</button>
      <button class="btn-ghost" onclick="go('staffAuth')">Staff Portal</button>
      <button class="btn-ghost" style="border-color:var(--border);color:var(--dim)" onclick="go('ownerAuth')">Owner Dashboard</button>
    </div>
    <div class="perks-preview">
      <span class="perk-pill">Free Entry</span>
      <span class="perk-pill">First Drink</span>
      <span class="perk-pill">Points &amp; Rewards</span>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ REGISTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="register">
    <button class="btn-back" onclick="go('landing')">‚Üê Back</button>
    <div class="eyebrow">Step 1 of 2</div>
    <div class="section-title">Create Your Account</div>
    <div style="height:28px"></div>
    <div class="form-group">
      <label class="form-label">Full Name</label>
      <input class="form-input" id="reg-name" type="text" placeholder="Your name">
    </div>
    <div class="form-group">
      <label class="form-label">Phone Number</label>
      <input class="form-input" id="reg-phone" type="tel" placeholder="+1 (555) 000-0000">
    </div>
    <div class="form-group">
      <label class="form-label">Email Address</label>
      <input class="form-input" id="reg-email" type="email" placeholder="you@email.com">
    </div>
    <div class="form-group">
      <label class="form-label">Date of Birth</label>
      <input class="form-input" id="reg-dob" type="date">
    </div>
    <div class="form-hint">By joining, you agree to receive SMS messages from Riddim.<br>Standard rates may apply.</div>
    <button class="btn-gold" onclick="handleRegister()">Send Verification Code</button>
  </div>

  <!-- ‚îÄ‚îÄ SMS VERIFY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="sms">
    <button class="btn-back" onclick="go('register')">‚Üê Back</button>
    <div style="flex:1;display:flex;flex-direction:column;justify-content:center;">
      <div class="eyebrow">Step 2 of 2</div>
      <div class="section-title">Verify Your Number</div>
      <p style="color:var(--muted);font-size:15px;line-height:1.8;margin-top:16px;">
        We sent a 6-digit code to <span style="color:var(--accent)" id="sms-phone"></span>
      </p>
      <input class="code-input" id="sms-input" maxlength="6" placeholder="000000" type="tel">
      <button class="btn-gold" onclick="handleVerify()">Verify &amp; Enter ‚Üí</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ MEMBER DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="dashboard">
    <div class="member-card">
      <div>
        <div class="eyebrow" style="margin-bottom:4px">Member</div>
        <div class="member-name" id="dash-name">‚Äî</div>
        <div class="member-id" id="dash-id">ID: ‚Äî</div>
        <div class="points-row">
          <span class="points-label" style="color:var(--accent);font-size:11px">PTS</span>
          <span class="points-num" id="dash-pts">0</span>
          <span class="points-label">points</span>
        </div>
      </div>
      <div style="text-align:center">
        <img id="dash-qr-small" class="qr-img" style="width:80px;height:80px;" alt="QR" src="">
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:6px">Your QR</div>
      </div>
    </div>
    <div class="qr-large">
      <div class="qr-label">Show at Entrance</div>
      <img id="dash-qr-large" class="qr-img" alt="QR Code" src="">
      <div class="qr-sub" id="dash-member-num">Member #</div>
    </div>
    <button class="btn-wallet" id="wallet-btn" onclick="generateWalletCard()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0">
        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
        <line x1="1" y1="10" x2="23" y2="10"/>
      </svg>
      Add to Wallet
    </button>
    <canvas id="wallet-canvas" style="display:none"></canvas>
    <div class="wifi-banner">
      <div class="wifi-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12.55a11 11 0 0 1 14.08 0"/>
          <path d="M1.42 9a16 16 0 0 1 21.16 0"/>
          <path d="M8.53 16.11a6 6 0 0 1 6.95 0"/>
          <line x1="12" y1="20" x2="12.01" y2="20"/>
        </svg>
      </div>
      <div>
        <div class="wifi-status">Connected to RIDDIM WiFi</div>
        <div class="wifi-note">Enjoy complimentary high-speed access</div>
      </div>
    </div>
    <div class="bday-banner" id="bday-banner" style="display:none">
      <div style="font-size:15px;color:var(--acid)">Happy Birthday Month, <span id="bday-name"></span>!</div>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:6px">Your birthday package is active. Speak to a host to reserve your celebration.</div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ RETURNING AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="returningAuth">
    <button class="btn-back" onclick="go('landing')">‚Üê Back</button>
    <div style="flex:1;display:flex;flex-direction:column;justify-content:center;">
      <div class="eyebrow">Returning Member</div>
      <div class="section-title">Welcome Back</div>
      <p style="color:var(--muted);font-size:15px;line-height:1.8;margin-top:16px;margin-bottom:32px;">Enter the phone number you registered with.</p>
      <div class="form-group">
        <label class="form-label">Phone Number</label>
        <input class="form-input" id="ret-phone" type="tel" placeholder="+1 (555) 000-0000">
      </div>
      <div id="ret-error" class="field-error">No member found with that number</div>
      <button class="btn-gold" onclick="handleReturningLogin()">Find My Account</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ RETURNING / MEMBER PORTAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="returning">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
      <button class="btn-back" style="margin-bottom:0" onclick="go('landing')">‚Üê Exit</button>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted)">MEMBER PORTAL</div>
    </div>
    <div class="member-card" style="margin-bottom:16px">
      <div>
        <div class="eyebrow" style="margin-bottom:4px">Member</div>
        <div class="member-name" id="ret-name"></div>
        <div class="member-id" id="ret-id"></div>
        <div class="points-row">
          <span class="points-label" style="color:var(--accent);font-size:11px">PTS</span>
          <span class="points-num" id="ret-pts">0</span>
          <span class="points-label">points</span>
        </div>
      </div>
      <div style="text-align:center">
        <img id="ret-qr" style="width:80px;height:80px;border-radius:8px" alt="QR" src="">
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:6px">Your QR</div>
      </div>
    </div>

    <!-- MEMBER TABS: Message ¬∑ Tonight ¬∑ Events ¬∑ Visits ¬∑ Settings -->
    <div class="owner-tabs">
      <div class="owner-tab active" onclick="switchRetTab('message',this)">Message</div>
      <div class="owner-tab" onclick="switchRetTab('perks',this)">Tonight</div>
      <div class="owner-tab" onclick="switchRetTab('events',this)">Events</div>
      <div class="owner-tab" onclick="switchRetTab('visits',this)">Visits</div>
      <div class="owner-tab" onclick="switchRetTab('settings',this)">Settings</div>
    </div>

    <!-- TAB: MESSAGE -->
    <div class="owner-tab-content active" id="ret-tab-message">
      <div class="perks-heading">Concierge</div>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:16px;line-height:1.8">Reach our team directly ‚Äî owner, management, floor staff, or security. We respond within minutes.</div>
      <div id="member-msg-thread" style="margin-bottom:16px"></div>
      <div id="member-msg-composer"></div>
    </div>

    <!-- TAB: TONIGHT (available rewards only) -->
    <div class="owner-tab-content" id="ret-tab-perks">
      <div class="perks-heading">Available Tonight</div>
      <div id="ret-perks-list"></div>
      <div style="margin-top:20px">
        <div class="perks-heading">Progress to Next Tier</div>
        <div id="ret-tier-progress"></div>
      </div>
    </div>

    <!-- TAB: EVENTS -->
    <div class="owner-tab-content" id="ret-tab-events">
      <div class="cal-section" style="margin-top:4px">
        <div class="cal-header">
          <button class="cal-nav-btn" onclick="retCalNav(-1)">‚Äπ</button>
          <div class="cal-month-label" id="ret-cal-month-label">Loading...</div>
          <button class="cal-nav-btn" onclick="retCalNav(1)">‚Ä∫</button>
        </div>
        <div class="cal-weekdays">
          <div class="cal-weekday">S</div><div class="cal-weekday">M</div><div class="cal-weekday">T</div>
          <div class="cal-weekday">W</div><div class="cal-weekday">T</div><div class="cal-weekday">F</div><div class="cal-weekday">S</div>
        </div>
        <div class="cal-days-grid" id="ret-cal-days"></div>
        <div class="cal-events-list" id="ret-cal-events"></div>
        <div class="cal-legend">
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(212,175,55,0.4)"></div>Event / DJ Night</div>
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(245,200,66,0.4)"></div>Daily Special</div>
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(244,114,182,0.4)"></div>Your Reservation</div>
        </div>
      </div>
    </div>

    <!-- TAB: VISITS -->
    <div class="owner-tab-content" id="ret-tab-visits">
      <div class="perks-heading">Visit History</div>
      <div id="ret-visits-list">
        <div style="padding:32px 0;text-align:center;color:var(--muted);font-family:'Space Mono',monospace;font-size:12px">Visit history coming soon</div>
      </div>
    </div>

    <!-- TAB: SETTINGS (formerly Wallet) -->
    <div class="owner-tab-content" id="ret-tab-settings">
      <div class="perks-heading">Wallet Card</div>
      <button class="btn-wallet" id="ret-wallet-btn" onclick="generateWalletCardFor(currentMember)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0">
          <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
          <line x1="1" y1="10" x2="23" y2="10"/>
        </svg>
        Add to Wallet
      </button>
      <canvas id="ret-wallet-canvas" style="display:none"></canvas>
      <div class="danger-zone" style="margin-top:24px">
        <div class="danger-zone-title">Account</div>
        <div class="danger-zone-text">Your data is archived and can be restored by contacting us.</div>
        <button class="btn-danger" onclick="confirmDeleteProfile()">Delete Profile</button>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ ADMIN AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="adminAuth">
    <button class="btn-back" onclick="go('landing')">‚Üê Back</button>
    <div style="flex:1;display:flex;flex-direction:column;justify-content:center;">
      <div class="eyebrow">Staff Access</div>
      <div class="section-title">Admin Portal</div>
      <div style="height:32px"></div>
      <div class="form-group">
        <label class="form-label">Admin PIN</label>
        <input class="form-input" id="admin-pin" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="letter-spacing:0.4em;font-size:22px">
      </div>
      <div id="admin-error" class="field-error">Incorrect PIN</div>
      <button class="btn-gold" onclick="handleAdminAuth()">Enter Portal</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ ADMIN PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="admin">
    <button class="btn-back" onclick="go('landing')">‚Üê Back</button>
    <div class="eyebrow">Admin</div>
    <div class="section-title">Member Management</div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-num" id="stat-total">0</div><div class="stat-label">Members</div></div>
      <div class="stat-card"><div class="stat-num" id="stat-pts">0</div><div class="stat-label">Total Pts</div></div>
      <div class="stat-card"><div class="stat-num" id="stat-month">0</div><div class="stat-label">This Month</div></div>
    </div>
    <button class="btn-gold" onclick="exportCSV()" style="margin-bottom:24px">Export Member Data (CSV)</button>
    <div class="perks-heading" id="admin-members-label">All Members (0)</div>
    <div id="admin-members-list"></div>
  </div>

  <!-- ‚îÄ‚îÄ STAFF AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="staffAuth">
    <button class="btn-back" onclick="go('landing')">‚Üê Back</button>
    <div style="flex:1;display:flex;flex-direction:column;justify-content:center;">
      <div class="eyebrow">Staff &amp; Promoter Access</div>
      <div class="section-title">Staff Portal</div>
      <p style="color:var(--muted);font-size:14px;line-height:1.8;margin-top:16px;margin-bottom:32px;font-family:'Space Mono',monospace">Enter your phone number to receive a 2FA code.</p>
      <div class="form-group">
        <label class="form-label">Your Phone Number</label>
        <input class="form-input" id="staff-pin" type="tel" placeholder="+13055551234" style="letter-spacing:0.05em;font-size:18px">
      </div>
      <div id="staff-error" class="field-error">Phone number not recognised ‚Äî check with your manager</div>
      <button class="btn-gold" onclick="handleStaffAuth()">Enter Portal</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ STAFF PORTAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="staff">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
      <button class="btn-back" style="margin-bottom:0" onclick="go('landing')">‚Üê Exit</button>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted)" id="staff-portal-label">STAFF PORTAL</div>
      <button onclick="logout()" style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);background:none;border:1px solid var(--border);padding:4px 10px;border-radius:4px;cursor:pointer">LOG OUT</button>
    </div>
    <div class="staff-role-header">
      <div>
        <div class="eyebrow">Tonight</div>
        <div class="staff-role-name" id="staff-role-display">Staff</div>
      </div>
      <span class="role-badge" id="staff-role-badge"></span>
    </div>

    <!-- My Link (all roles) -->
    <div id="staff-link-area" style="margin-bottom:16px">
      <div class="perks-heading" style="margin-bottom:8px">My Referral Link</div>
      <div class="staff-link-card" id="staff-link-card">
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">GUEST LIST / REGISTRATION</div>
        <div style="font-family:'Space Mono',monospace;font-size:12px;color:var(--accent);word-break:break-all" id="staff-link-url">‚Äî</div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="cal-save-btn" onclick="copyStaffLink()">Copy Link</button>
          <button class="cal-save-btn" onclick="showStaffLinkQR()">Show QR</button>
        </div>
      </div>
    </div>

    <!-- Section assignment (waitress) -->
    <div id="staff-section-info" style="display:none">
      <div class="section-badge">
        <span>üìç</span>
        <span id="staff-section-label">No section assigned</span>
      </div>
    </div>

    <!-- QR Scanner (all check-in roles) -->
    <div id="staff-scan-area">
      <div class="scan-box" onclick="startScanner()" id="scan-box">
        <div class="scan-box-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5">
            <path d="M3 7V5a2 2 0 012-2h2M17 3h2a2 2 0 012 2v2M21 17v2a2 2 0 01-2 2h-2M7 21H5a2 2 0 01-2-2v-2"/>
            <rect x="7" y="7" width="3" height="3"/><rect x="14" y="7" width="3" height="3"/>
            <rect x="7" y="14" width="3" height="3"/><rect x="14" y="14" width="3" height="3"/>
          </svg>
        </div>
        <div class="scan-box-label">TAP TO SCAN MEMBER QR</div>
      </div>
      <video id="scanner-video" autoplay playsinline></video>
      <button id="stop-scanner-btn"
        style="display:none;width:100%;padding:12px;background:transparent;border:1px solid var(--border);border-radius:8px;color:var(--muted);font-family:'Space Mono',monospace;font-size:11px;cursor:pointer;margin-bottom:16px"
        onclick="stopScanner()">Stop Scanner</button>
      <div id="staff-lookup-area">
      <div class="perks-heading" style="margin-top:8px">Manual Lookup</div>
      <div class="staff-lookup">
        <input class="form-input" id="staff-search" type="text" placeholder="Name or phone">
        <button onclick="staffLookup()">Search</button>
      </div>
      </div>
      <div class="staff-member-result" id="staff-member-result">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px">
          <div>
            <div class="eyebrow" style="margin-bottom:4px">Checked In</div>
            <div style="font-size:22px" id="staff-result-name"></div>
            <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:4px" id="staff-result-id"></div>
          </div>
          <div style="text-align:right">
            <div style="font-size:22px;color:var(--accent)" id="staff-result-pts"></div>
            <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted)">points</div>
          </div>
        </div>
        <div id="staff-perks-area">
          <div class="perks-heading">Redeem Perks</div>
          <div id="staff-perks-list"></div>
          <div style="margin-top:16px;display:flex;gap:10px" id="staff-pts-area">
            <input class="form-input" id="staff-pts-input" type="number" placeholder="Add points" style="flex:1">
            <button onclick="staffAddPoints()"
              style="padding:15px 16px;background:var(--bg2);border:1px solid var(--border);border-radius:10px;color:var(--accent);font-family:'Space Mono',monospace;font-size:11px;cursor:pointer;transition:all 0.2s;"
              onmouseover="this.style.borderColor='var(--accent)'"
              onmouseout="this.style.borderColor='var(--border)'">Add Pts</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Guest Messages (role-dependent) -->
    <div id="staff-sms-area" style="display:none">
      <div class="perks-heading" style="margin-top:16px">Guest Messages</div>
      <div id="staff-sms-threads"></div>
    </div>

    <!-- Promoter Panel (promoter role only) -->
    <div id="staff-promoter-area" style="display:none">
      <div class="perks-heading" style="margin-top:16px">My Nights</div>
      <div id="promoter-events-list"></div>
      <div class="perks-heading" style="margin-top:20px">Guest List</div>
      <div id="promoter-guestlist"></div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <input class="form-input" id="promoter-guest-input" placeholder="Member name or phone number" style="flex:1">
        <button class="cal-save-btn" onclick="addPromoterGuest()">+ Add</button>
      </div>
      <div class="perks-heading" style="margin-top:20px">Stats</div>
      <div id="promoter-stats"></div>
    </div>

    <!-- Schedule & Events Calendar (all staff) -->
    <div id="staff-cal-area">
      <div class="perks-heading" style="margin-top:24px;margin-bottom:0">Schedule &amp; Events</div>
      <div class="cal-section" style="margin-top:12px">
        <div class="cal-header">
          <button class="cal-nav-btn" onclick="staffCalNav(-1)">‚Äπ</button>
          <div class="cal-month-label" id="staff-cal-month-label">Loading...</div>
          <button class="cal-nav-btn" onclick="staffCalNav(1)">‚Ä∫</button>
        </div>
        <div class="cal-weekdays">
          <div class="cal-weekday">S</div><div class="cal-weekday">M</div><div class="cal-weekday">T</div>
          <div class="cal-weekday">W</div><div class="cal-weekday">T</div><div class="cal-weekday">F</div><div class="cal-weekday">S</div>
        </div>
        <div class="cal-days-grid" id="staff-cal-days"></div>
        <div class="cal-events-list" id="staff-cal-events"></div>
        <div class="cal-legend">
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(96,165,250,0.4)"></div>Your Shifts</div>
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(212,175,55,0.4)"></div>Events</div>
        </div>
      </div>
    </div>

    <!-- Schedule Management (manager & vip-host only) -->
    <div id="staff-schedule-area" style="display:none">
      <div class="perks-heading" style="margin-top:24px">On Duty Tonight</div>
      <div id="on-duty-list" style="margin-bottom:16px"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="perks-heading" style="margin:0">This Week</div>
        <button id="staff-add-shift-btn" class="cal-save-btn" onclick="openScheduleForm('staff')">+ Add Shift</button>
      </div>
      <div id="staff-weekly-schedule"></div>
      <div id="schedule-panel"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ OWNER AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="ownerAuth">
    <button class="btn-back" onclick="go('landing')">‚Üê Back</button>
    <div style="flex:1;display:flex;flex-direction:column;justify-content:center;">
      <div class="eyebrow">Owner Access</div>
      <div class="section-title">Owner Dashboard</div>
      <div style="height:32px"></div>
      <div class="form-group">
        <label class="form-label">Owner PIN</label>
        <input class="form-input" id="owner-pin" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="letter-spacing:0.4em;font-size:22px">
      </div>
      <div id="owner-error" class="field-error">Incorrect PIN</div>
      <button class="btn-gold" onclick="handleOwnerAuth()">Enter Dashboard</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ OWNER DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="screen" id="owner">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
      <button class="btn-back" style="margin-bottom:0" onclick="go('landing')">‚Üê Exit</button>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted)">OWNER</div>
      <button onclick="logout()" style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);background:none;border:1px solid var(--border);padding:4px 10px;border-radius:4px;cursor:pointer">LOG OUT</button>
    </div>
    <div class="eyebrow">Overview</div>
    <div class="section-title" style="margin-bottom:20px">Dashboard</div>
    <div class="owner-tabs">
      <div class="owner-tab active" onclick="switchOwnerTab('overview',this)">Overview</div>
      <div class="owner-tab" onclick="switchOwnerTab('members',this)">Members</div>
      <div class="owner-tab" onclick="switchOwnerTab('calendar',this)">Calendar</div>
      <div class="owner-tab" onclick="switchOwnerTab('schedule',this)">Schedule</div>
      <div class="owner-tab" onclick="switchOwnerTab('messages',this)">Messages</div>
      <div class="owner-tab" onclick="switchOwnerTab('staff',this)">Staff</div>
      <div class="owner-tab" onclick="switchOwnerTab('tickets',this)">Tickets</div>
      <div class="owner-tab" onclick="switchOwnerTab('export',this)">Export</div>
    </div>

    <!-- OVERVIEW -->
    <div class="owner-tab-content active" id="owner-tab-overview">
      <div class="metric-grid">
        <div class="metric-card" data-card="total" onclick="toggleOverviewCard('total')" style="cursor:pointer;transition:border-color 0.2s">
          <div class="metric-val" id="ow-total">0</div>
          <div class="metric-label">TOTAL MEMBERS</div>
          <div class="metric-change" id="ow-new">+0 this month</div>
        </div>
        <div class="metric-card" data-card="pts" onclick="toggleOverviewCard('pts')" style="cursor:pointer;transition:border-color 0.2s">
          <div class="metric-val" id="ow-pts">0</div>
          <div class="metric-label">POINTS ISSUED</div>
        </div>
        <div class="metric-card" data-card="tonight" onclick="toggleOverviewCard('tonight')" style="cursor:pointer;transition:border-color 0.2s">
          <div class="metric-val" id="ow-tonight">0</div>
          <div class="metric-label">JOINED TONIGHT</div>
        </div>
        <div class="metric-card" data-card="bday" onclick="toggleOverviewCard('bday')" style="cursor:pointer;transition:border-color 0.2s">
          <div class="metric-val" id="ow-bday">0</div>
          <div class="metric-label">BIRTHDAYS THIS MONTH</div>
        </div>
      </div>
      <!-- Drilldown panel ‚Äî shown when a card is clicked -->
      <div id="overview-drilldown" style="display:none;margin-top:16px;background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:16px;max-height:400px;overflow-y:auto"></div>
    </div>

    <!-- MEMBERS -->
    <div class="owner-tab-content" id="owner-tab-members">
      <div style="display:flex;gap:10px;margin-bottom:16px">
        <input class="form-input" id="owner-search" type="text" placeholder="Search name, phone, email" oninput="ownerSearch()" style="flex:1">
        <button class="btn-gold" style="white-space:nowrap;padding:10px 16px;font-size:12px" onclick="showOwnerAddMemberModal()">+ Add Member</button>
      </div>
      <div id="owner-members-list"></div>
      <button class="btn-ghost" style="margin-top:16px;width:100%" onclick="exportCSV()">Export All Members (CSV)</button>
    </div>

    <!-- CALENDAR -->
    <div class="owner-tab-content" id="owner-tab-calendar">
      <!-- Subcategory views (top) -->
      <div id="owner-cal-subs" style="margin-bottom:20px"></div>

      <!-- Reservation Queue ‚Äî owner approves here -->
      <div class="perks-heading" style="margin-top:4px">Reservation Requests</div>
      <div id="owner-reservations-list" style="margin-bottom:20px"></div>

      <!-- Month view (bottom) -->
      <div class="perks-heading" style="margin-top:4px">Month View</div>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:12px;line-height:1.8">Full calendar ‚Äî events, shifts, reservations. Click any date to view or add.</div>
      <div class="cal-section">
        <div class="cal-header">
          <button class="cal-nav-btn" onclick="ownerCalNav(-1)">‚Äπ</button>
          <div class="cal-month-label" id="owner-cal-month-label">Loading...</div>
          <button class="cal-nav-btn" onclick="ownerCalNav(1)">‚Ä∫</button>
        </div>
        <div class="cal-weekdays">
          <div class="cal-weekday">S</div><div class="cal-weekday">M</div><div class="cal-weekday">T</div>
          <div class="cal-weekday">W</div><div class="cal-weekday">T</div><div class="cal-weekday">F</div><div class="cal-weekday">S</div>
        </div>
        <div class="cal-days-grid" id="owner-cal-days"></div>
        <div class="cal-events-list" id="owner-cal-events"></div>
        <div class="cal-legend">
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(212,175,55,0.4)"></div>Events</div>
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(96,165,250,0.4)"></div>Staff Shifts</div>
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(52,211,153,0.4)"></div>Promoter Nights</div>
          <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(244,114,182,0.4)"></div>Reservations</div>
        </div>
      </div>

      <!-- Sales Log -->
      <div class="perks-heading" style="margin-top:24px">Ticket &amp; Table Sales</div>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:12px">All purchases and promoter-attributed transactions tonight.</div>
      <div id="owner-sales-log"></div>
    </div>

    <!-- SCHEDULE -->
    <div class="owner-tab-content" id="owner-tab-schedule">
      <!-- On Duty Tonight -->
      <div class="perks-heading">On Duty Tonight</div>
      <div id="owner-on-duty-list" style="margin-bottom:20px"></div>

      <!-- Monthly Schedule Calendar -->
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <div class="perks-heading" style="margin:0">Schedule</div>
        <button id="owner-add-shift-btn" class="cal-save-btn" onclick="openScheduleForm('owner')">+ Add Shift</button>
      </div>

      <div class="cal-section" style="margin-bottom:16px">
        <div class="cal-header">
          <button class="cal-nav-btn" onclick="ownerSchedCalNav(-1)">‚Äπ</button>
          <div class="cal-month-label" id="owner-sched-cal-label">Loading...</div>
          <button class="cal-nav-btn" onclick="ownerSchedCalNav(1)">‚Ä∫</button>
        </div>
        <div class="cal-weekdays">
          <div class="cal-weekday">S</div><div class="cal-weekday">M</div><div class="cal-weekday">T</div>
          <div class="cal-weekday">W</div><div class="cal-weekday">T</div><div class="cal-weekday">F</div><div class="cal-weekday">S</div>
        </div>
        <div class="cal-days-grid" id="owner-sched-cal-grid"></div>
      </div>

      <!-- Selected day / week view -->
      <div id="owner-sched-selected-view" style="margin-bottom:20px"></div>
      <div id="owner-schedule-panel"></div>
    </div>

    <!-- MESSAGES -->
    <div class="owner-tab-content" id="owner-tab-messages">
      <div class="perks-heading" style="margin-bottom:4px">All Messages</div>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:16px;line-height:1.8">All threads routed here. Compose a new message to any member or staff.</div>
      <div id="owner-new-thread-area"></div>
      <div id="owner-sms-threads"></div>
    </div>

    <!-- STAFF ‚Äî collapsible sections, rendered by renderOwnerStaff() -->
    <div class="owner-tab-content" id="owner-tab-staff">
      <!-- Populated entirely by renderOwnerStaff() -->
    </div>

    <!-- TICKETS & COMPS (owner only) -->
    <div class="owner-tab-content" id="owner-tab-tickets">
      <div class="perks-heading">Pricing Settings</div>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:16px;line-height:1.8">Set ticket and table prices. These apply to all staff links and the public guest page.</div>
      <div id="owner-pricing-list"></div>

      <div class="perks-heading" style="margin-top:24px">Comp Tickets &amp; Tables</div>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:16px;line-height:1.8">Issue complimentary tickets or table reservations. Only you can comp.</div>
      <div style="display:flex;flex-direction:column;gap:10px">
        <select class="form-input" id="comp-type" style="font-family:'Space Mono',monospace;font-size:12px">
          <option value="ticket">General Admission Ticket</option>
          <option value="vip-ticket">VIP Ticket</option>
          <option value="table">Table Reservation</option>
        </select>
        <div style="position:relative">
          <input class="form-input" id="comp-recipient" placeholder="Search member name or phone..." autocomplete="off" oninput="onCompRecipientInput(this.value)">
          <div id="comp-member-dropdown" style="display:none;position:absolute;top:100%;left:0;right:0;background:var(--bg2);border:1px solid var(--accent);border-radius:0 0 10px 10px;z-index:200;max-height:180px;overflow-y:auto"></div>
        </div>
        <div id="comp-member-confirm" style="display:none;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;font-family:'Space Mono',monospace;font-size:10px;color:var(--muted)"></div>
        <input class="form-input" id="comp-note" placeholder="Note (optional)">
        <button class="btn-gold" onclick="issueComp()">Issue Comp</button>
      </div>
      <div class="perks-heading" style="margin-top:24px">Comps Issued Tonight</div>
      <div id="owner-comps-list"></div>
    </div>

    <!-- EXPORT -->
    <div class="owner-tab-content" id="owner-tab-export">
      <div style="display:flex;flex-direction:column;gap:12px;margin-top:8px">
        <button class="btn-gold" onclick="exportCSV()">Export Members CSV</button>
        <button class="btn-ghost" onclick="exportJSON()">Export Members JSON</button>
      </div>
      <div style="margin-top:24px">
        <div class="perks-heading">Data Includes</div>
        <div style="font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);line-height:2.2">
          ID ¬∑ Full Name ¬∑ Phone ¬∑ Email ¬∑ Date of Birth<br>
          Member Since ¬∑ Points Balance ¬∑ Visit Count
        </div>
      </div>

      <!-- DEV TOOLS ‚Äî remove before production -->
      <div style="margin-top:32px;border-top:1px solid var(--border);padding-top:20px">
        <div class="perks-heading" style="color:var(--error)">DEV TOOLS</div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:12px;line-height:1.8">
          Simulated session data only. Remove before going live.
        </div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <button class="btn-ghost" onclick="devClearSession()" style="border-color:var(--error);color:var(--error)">
            Clear Session &amp; Device Trust
          </button>
          <button class="btn-ghost" onclick="devClearMac()" style="border-color:var(--error);color:var(--error)">
            Reset Simulated MAC Address
          </button>
        </div>
        <div id="dev-clear-confirm" style="display:none;font-family:'Space Mono',monospace;font-size:10px;color:#34D399;margin-top:10px">
          ‚úì Cleared ‚Äî reload page to start fresh session
        </div>
      </div>
    </div>
  </div>

</div><!-- /app -->

<!-- ‚îÄ‚îÄ 2FA / DEVICE TRUST MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="security-modal" id="twofa-modal" style="display:none">
  <div class="security-modal-card">
    <div class="security-icon" id="twofa-icon">üîê</div>
    <div class="security-title" id="twofa-title">Verify It's You</div>
    <div class="security-sub" id="twofa-sub">We sent a 6-digit code to your phone number to confirm your identity.</div>
    <input class="security-code-input" id="twofa-input" maxlength="6" placeholder="000000" type="tel" oninput="this.value=this.value.replace(/\D/g,'')">
    <button class="btn-gold" onclick="handleTwoFAVerify()">Confirm Identity ‚Üí</button>
    <div id="twofa-error" class="field-error" style="text-align:center;margin-top:10px">Incorrect code. Try again.</div>
  </div>
</div>

<!-- ‚îÄ‚îÄ DEVICE TRUST PROMPT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="security-modal" id="device-trust-modal" style="display:none">
  <div class="security-modal-card">
    <div class="security-icon">üõ°Ô∏è</div>
    <div class="security-title">Trust This Device?</div>
    <div class="security-sub">Would you like to trust this device? Trusted devices skip 2FA for 21 days.</div>
    <div class="security-trust-row">
      <button class="btn-trust" onclick="handleDeviceTrust(true)">Trust Device</button>
      <button class="btn-no-trust" onclick="handleDeviceTrust(false)">Don't Trust</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ RESERVATION DETAIL MODAL (owner/manager/vip-host) ‚îÄ‚îÄ -->
<div class="security-modal" id="res-detail-modal" style="display:none">
  <div class="security-modal-card" style="max-width:440px">
    <div class="security-title" style="font-size:18px;margin-bottom:4px" id="res-modal-name">Reservation</div>
    <div class="security-sub" id="res-modal-meta" style="margin-bottom:20px"></div>
    <div id="res-modal-body"></div>
    <div style="display:flex;gap:10px;margin-top:16px">
      <button class="btn-gold" onclick="confirmReservation()">Confirm</button>
      <button class="btn-ghost" onclick="document.getElementById('res-detail-modal').style.display='none'">Close</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ STAFF LINK QR MODAL ‚îÄ‚îÄ -->
<div class="security-modal" id="staff-qr-modal" style="display:none">
  <div class="security-modal-card" style="max-width:320px;text-align:center">
    <div class="security-title" style="font-size:16px;margin-bottom:16px">Your Referral QR</div>
    <div id="staff-qr-display" style="display:flex;justify-content:center;margin-bottom:16px"></div>
    <div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--muted);margin-bottom:16px">Share or display this at your station</div>
    <button class="btn-ghost" onclick="document.getElementById('staff-qr-modal').style.display='none'">Close</button>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
